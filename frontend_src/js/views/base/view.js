// Generated by CoffeeScript 1.6.3
var __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

define(['chaplin', 'handlebars', 'helper'], function(Chaplin, Handlebars, Helper) {
  'use strict';
  var View, _ref;
  return View = (function(_super) {
    __extends(View, _super);

    function View() {
      _ref = View.__super__.constructor.apply(this, arguments);
      return _ref;
    }

    View.prototype.autoRender = false;

    View.prototype.events = {
      'click': function(e) {
        var $target;
        $target = $(e.target);
        if ($target.attr('data-link') != null) {
          this.publishEvent('redirect', $target.attr('data-link'));
        }
        if ($target.attr('data-to-login') != null) {
          return this.publishEvent('goLogin', $target.attr('data-to-login'));
        }
      }
    };

    View.prototype.initialize = function() {
      this.initHandlebarsHelpers();
      this.checkTemplate();
      return this.rendered = false;
    };

    View.prototype.initHandlebarsHelpers = function() {
      return Handlebars.registerHelper('equals', function(a, b, block) {
        if (parseInt(a) === parseInt(b)) {
          return block.fn(this);
        } else {
          return block.inverse(this);
        }
      });
    };

    View.prototype.checkTemplate = function() {
      if (JST[this.templateName] == null) {
        throw "no template with name " + this.templateName + " found";
      }
    };

    View.prototype.getTemplateFunction = function() {
      var templateFunc;
      return templateFunc = JST[this.templateName];
    };

    View.prototype.render = function() {
      View.__super__.render.apply(this, arguments);
      this.manageAuthAreas();
      this.manageEditableContent();
      pressFooter();
      return this.rendered = true;
    };

    View.prototype.softRender = function() {
      if (this.rendered) {
        this.$el.html(JST[this.templateName](this.getTemplateData()));
        pressFooter();
        this.manageAuthAreas();
        return this.manageEditableContent();
      } else {
        return this.render();
      }
    };

    View.prototype.setRegion = function(region) {
      this.region = region;
      return this;
    };

    View.prototype.manageEditableContent = function() {
      var el, id, _i, _len, _ref1, _results;
      _ref1 = this.$el.find("[data-managed-content]");
      _results = [];
      for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
        el = _ref1[_i];
        id = $(el).attr('data-managed-content');
        _results.push($(el).html(managedContent[id].text));
      }
      return _results;
    };

    View.prototype.manageAuthAreas = function() {
      var b, elementsThatHavePermission, it, map, _i, _len, _ref1, _ref2, _results;
      if (((_ref1 = this.model) != null ? _ref1.access : void 0) != null) {
        elementsThatHavePermission = this.$el.find("[data-permission]");
        map = $.map(elementsThatHavePermission, function(it) {
          return {
            el: it,
            perm: $(it).attr('data-permission').split(',')
          };
        });
        _results = [];
        for (_i = 0, _len = map.length; _i < _len; _i++) {
          it = map[_i];
          b = (_ref2 = this.model.access, __indexOf.call(it.perm, _ref2) >= 0);
          if (b) {
            _results.push($(it.el).show());
          } else {
            _results.push($(it.el).hide());
          }
        }
        return _results;
      }
    };

    View.prototype.permissions = {
      'admin': ['create', 'update', 'read'],
      'guest': ['read'],
      'author': ['create', 'update', 'read'],
      'user': ['read']
    };

    View.prototype.getTemplateData = function() {
      if (this.model != null) {
        return {
          model: this.model.data
        };
      }
    };

    return View;

  })(Chaplin.View);
});
